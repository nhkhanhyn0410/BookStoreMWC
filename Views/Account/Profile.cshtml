@model BookStoreMVC.Models.ViewModels.UserProfileViewModel

@{
    ViewData["Title"] = "Hồ sơ cá nhân";
}

@section Styles {
    <style>
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .tab-content {
            min-height: 400px;
        }

        .stat-card {
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .avatar-upload {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .avatar-upload:hover .avatar-overlay {
            opacity: 1;
        }

        .avatar-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 50%;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-floating label {
            position: absolute;
            top: 50%;
            left: 12px;
            transform: translateY(-50%);
            transition: all 0.2s ease;
            pointer-events: none;
            color: #6b7280;
        }

        .form-floating input:focus+label,
        .form-floating input:not(:placeholder-shown)+label {
            top: 8px;
            font-size: 0.75rem;
            color: #3b82f6;
        }
    </style>
}

<div class="max-w-6xl mx-auto">
    <!-- Profile Header -->
    <div class="profile-header text-white p-8 rounded-lg shadow-lg mb-8">
        <div class="flex flex-col md:flex-row items-center space-y-6 md:space-y-0 md:space-x-8">
            <!-- Avatar -->
            @* <div class="avatar-upload w-32 h-32 bg-white rounded-full shadow-lg flex items-center justify-center">
                @if (!string.IsNullOrEmpty(Model.AvatarUrl))
                {
                    <img src="@Model.AvatarUrl" alt="Avatar" class="w-full h-full rounded-full object-cover" />
                }
                else
                {
                    <i class="fas fa-user text-gray-400 text-4xl"></i>
                }
                <div class="avatar-overlay">
                    <i class="fas fa-camera text-white text-xl"></i>
                </div>
                <input type="file" id="avatarUpload" accept="image/*" class="hidden" onchange="uploadAvatar(this)" />
            </div> *@

            <!-- User Info -->
            <div class="text-center md:text-left">
                <h1 class="text-3xl font-bold mb-2">@Model.Name</h1>
                <p class="text-lg opacity-90 mb-2">@Model.Email</p>
                <div class="flex flex-wrap justify-center md:justify-start gap-4 text-sm">
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full">
                        <i class="fas fa-calendar-alt mr-1"></i>
                        @* Tham gia @Model.CreatedAt.ToString("MM/yyyy") *@
                    </span>
                    @if (!string.IsNullOrEmpty(Model.PhoneNumber))
                    {
                        <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full">
                            <i class="fas fa-phone mr-1"></i>
                            @Model.PhoneNumber
                        </span>
                    }
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-3 gap-4 text-center ml-auto">
                <div>
                    <div class="text-2xl font-bold">@Model.TotalOrders</div>
                    <div class="text-sm opacity-80">Đơn hàng</div>
                </div>
                <div>
                    <div class="text-2xl font-bold">@Model.TotalSpent.ToString("C0")</div>
                    <div class="text-sm opacity-80">Đã chi</div>
                </div>
                <div>
                    <div class="text-2xl font-bold">@Model.ReviewsCount</div>
                    <div class="text-sm opacity-80">Đánh giá</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="stat-card bg-blue-50 p-6 rounded-lg">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-blue-600 text-sm font-medium">Tổng đơn hàng</p>
                    <p class="text-2xl font-bold text-blue-900">@Model.TotalOrders</p>
                </div>
                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-shopping-bag text-blue-600 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="stat-card bg-green-50 p-6 rounded-lg">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-green-600 text-sm font-medium">Tổng chi tiêu</p>
                    <p class="text-2xl font-bold text-green-900">@Model.TotalSpent.ToString("C0")</p>
                </div>
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-chart-line text-green-600 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="stat-card bg-yellow-50 p-6 rounded-lg">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-yellow-600 text-sm font-medium">Đánh giá</p>
                    <p class="text-2xl font-bold text-yellow-900">@Model.ReviewsCount</p>
                </div>
                <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-star text-yellow-600 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="stat-card bg-purple-50 p-6 rounded-lg">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-purple-600 text-sm font-medium">Yêu thích</p>
                    <p class="text-2xl font-bold text-purple-900">@Model.WishlistCount</p>
                </div>
                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-heart text-purple-600 text-xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="bg-white rounded-lg shadow-md mb-8">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8 px-6">
                <button onclick="showTab('profile')"
                    class="tab-btn border-b-2 border-blue-500 py-4 px-1 text-sm font-medium text-blue-600"
                    id="profile-tab">
                    <i class="fas fa-user mr-2"></i>
                    Thông tin cá nhân
                </button>
                <button onclick="showTab('security')"
                    class="tab-btn border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700"
                    id="security-tab">
                    <i class="fas fa-shield-alt mr-2"></i>
                    Bảo mật
                </button>
                <button onclick="showTab('preferences')"
                    class="tab-btn border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700"
                    id="preferences-tab">
                    <i class="fas fa-cog mr-2"></i>
                    Tùy chọn
                </button>
                <button onclick="showTab('orders')"
                    class="tab-btn border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700"
                    id="orders-tab">
                    <i class="fas fa-shopping-bag mr-2"></i>
                    Đơn hàng gần đây
                </button>
            </nav>
        </div>

        <!-- Tab Contents -->
        <div class="p-6">
            <!-- Profile Information Tab -->
            <div id="profile-content" class="tab-content">
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Thông tin cá nhân</h3>

                <form asp-action="UpdateProfile" method="post" id="profileForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Basic Information -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-medium text-gray-800 mb-4">Thông tin cơ bản</h4>

                            <div class="form-group">
                                <div class="form-floating relative">
                                    <input asp-for="Name"
                                        class="w-full px-4 pt-6 pb-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                        placeholder=" " />
                                    <label asp-for="Name">Họ và tên</label>
                                </div>
                                <span asp-validation-for="Name" class="text-red-600 text-sm"></span>
                            </div>

                            <div class="form-group">
                                <div class="form-floating relative">
                                    <input asp-for="Email" type="email" readonly
                                        class="w-full px-4 pt-6 pb-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500"
                                        placeholder=" " />
                                    <label asp-for="Email">Email (không thể thay đổi)</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-floating relative">
                                    <input asp-for="PhoneNumber" type="tel"
                                        class="w-full px-4 pt-6 pb-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                        placeholder=" " />
                                    <label asp-for="PhoneNumber">Số điện thoại</label>
                                </div>
                                <span asp-validation-for="PhoneNumber" class="text-red-600 text-sm"></span>
                            </div>

                            @* <div class="form-group">
                                <div class="form-floating relative">
                                    <input asp-for="DateOfBirth" type="date"
                                           class="w-full px-4 pt-6 pb-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                           placeholder=" " />
                                    <label asp-for="DateOfBirth">Ngày sinh</label>
                                </div>
                            </div> *@
                        </div>

                        <!-- Address Information -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-medium text-gray-800 mb-4">Địa chỉ</h4>

                            <div class="form-group">
                                <div class="form-floating relative">
                                    @* <input asp-for="Address" 
                                           class="w-full px-4 pt-6 pb-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                           placeholder=" " />
                                    <label asp-for="Address">Địa chỉ</label> *@
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-floating relative">
                                    @* <input asp-for="City" 
                                           class="w-full px-4 pt-6 pb-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                           placeholder=" " />
                                    <label asp-for="City">Thành phố</label> *@
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-floating relative">
                                    @* <select asp-for="Province" 
                                            class="w-full px-4 pt-6 pb-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors">
                                        <option value="">Chọn tỉnh/thành</option>
                                        <option value="Hồ Chí Minh">Hồ Chí Minh</option>
                                        <option value="Hà Nội">Hà Nội</option>
                                        <option value="Đà Nẵng">Đà Nẵng</option>
                                        <option value="Cần Thơ">Cần Thơ</option>
                                        <!-- Add more provinces -->
                                    </select> *@
                                    @* <label asp-for="Province">Tỉnh/Thành phố</label> *@
                                </div>
                            </div>

                            <div class="form-group">
                                @* <div class="form-floating relative">
                                    <input asp-for="ZipCode" 
                                           class="w-full px-4 pt-6 pb-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                           placeholder=" " />
                                    <label asp-for="ZipCode">Mã bưu điện</label>
                                </div> *@
                            </div>
                        </div>
                    </div>

                    <!-- Bio -->
                    @* <div class="mt-6">
                        <label asp-for="Bio" class="block text-sm font-medium text-gray-700 mb-2">Giới thiệu bản thân</label>
                        <textarea asp-for="Bio" rows="4" 
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                  placeholder="Chia sẻ một chút về bản thân bạn..."></textarea>
                    </div> *@

                    <div class="mt-8">
                        <button type="submit"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                            <i class="fas fa-save mr-2"></i>
                            Lưu thông tin
                        </button>
                    </div>
                </form>
            </div>

            <!-- Security Tab -->
            <div id="security-content" class="tab-content hidden">
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Bảo mật tài khoản</h3>

                <!-- Change Password -->
                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                    <h4 class="text-lg font-medium text-gray-800 mb-4">Thay đổi mật khẩu</h4>

                    <form asp-action="ChangePassword" method="post" id="passwordForm">
                        <div class="space-y-4">
                            <div class="form-group">
                                <div class="form-floating relative">
                                    <input name="CurrentPassword" type="password"
                                        class="w-full px-4 pt-6 pb-2 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                        placeholder=" " />
                                    <label>Mật khẩu hiện tại</label>
                                    <button type="button"
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                                        onclick="togglePassword('CurrentPassword')">
                                        <i class="fas fa-eye" id="CurrentPassword-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-floating relative">
                                    <input name="NewPassword" type="password"
                                        class="w-full px-4 pt-6 pb-2 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                        placeholder=" " />
                                    <label>Mật khẩu mới</label>
                                    <button type="button"
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                                        onclick="togglePassword('NewPassword')">
                                        <i class="fas fa-eye" id="NewPassword-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-floating relative">
                                    <input name="ConfirmPassword" type="password"
                                        class="w-full px-4 pt-6 pb-2 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                        placeholder=" " />
                                    <label>Xác nhận mật khẩu mới</label>
                                    <button type="button"
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                                        onclick="togglePassword('ConfirmPassword')">
                                        <i class="fas fa-eye" id="ConfirmPassword-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <button type="submit"
                                class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-key mr-2"></i>
                                Đổi mật khẩu
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Two-Factor Authentication -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h4 class="text-lg font-medium text-gray-800 mb-4">Xác thực hai yếu tố</h4>
                    <p class="text-gray-600 mb-4">Tăng cường bảo mật tài khoản với xác thực hai yếu tố</p>

                    <button onclick="enable2FA()"
                        class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-shield-alt mr-2"></i>
                        Kích hoạt 2FA
                    </button>
                </div>
            </div>

            <!-- Preferences Tab -->
            <div id="preferences-content" class="tab-content hidden">
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Tùy chỉnh</h3>

                <form asp-action="UpdatePreferences" method="post">
                    <div class="space-y-6">
                        <!-- Email Notifications -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h4 class="text-lg font-medium text-gray-800 mb-4">Thông báo Email</h4>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" name="EmailNewsletter" checked
                                        class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                                    <span class="ml-3 text-sm text-gray-700">Nhận bản tin và ưu đãi đặc biệt</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="EmailOrderUpdates" checked
                                        class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                                    <span class="ml-3 text-sm text-gray-700">Cập nhật trạng thái đơn hàng</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="EmailReviewReminders"
                                        class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                                    <span class="ml-3 text-sm text-gray-700">Nhắc nhở đánh giá sản phẩm</span>
                                </label>
                            </div>
                        </div>

                        <!-- Privacy Settings -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h4 class="text-lg font-medium text-gray-800 mb-4">Quyền riêng tư</h4>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" name="ProfilePublic"
                                        class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                                    <span class="ml-3 text-sm text-gray-700">Hiển thị hồ sơ công khai</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="ShowPurchaseHistory"
                                        class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                                    <span class="ml-3 text-sm text-gray-700">Hiển thị lịch sử mua hàng</span>
                                </label>
                            </div>
                        </div>

                        <button type="submit"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                            <i class="fas fa-save mr-2"></i>
                            Lưu tùy chọn
                        </button>
                    </div>
                </form>
            </div>

            <!-- Recent Orders Tab -->
            <div id="orders-content" class="tab-content hidden">
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Đơn hàng gần đây</h3>

                @if (Model.RecentOrders?.Any() == true)
                {
                    <div class="space-y-4">
                        @foreach (var order in Model.RecentOrders)
                        {
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h4 class="font-semibold text-gray-800">Đơn hàng #@order.OrderNumber</h4>
                                        <p class="text-gray-600 text-sm">@order.CreatedAt.ToString("dd/MM/yyyy HH:mm")</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="@order.StatusCssClass px-3 py-1 rounded-full text-sm font-semibold mb-2">
                                            @order.StatusDisplayName
                                        </div>
                                        <div class="text-lg font-bold text-gray-800">@order.Total.ToString("C0")</div>
                                    </div>
                                </div>

                                <div class="flex items-center space-x-4 mb-4">
                                    @foreach (var item in order.OrderItems.Take(3))
                                    {
                                        <div class="flex items-center space-x-2">
                                            <img src="@(item.BookImageUrl ?? "/images/no-book-cover.png")" alt="@item.BookTitle"
                                                class="w-12 h-16 object-cover rounded shadow-sm" />
                                            <div class="text-sm">
                                                <p class="font-medium text-gray-800 line-clamp-1">@item.BookTitle</p>
                                                <p class="text-gray-600">SL: @item.Quantity</p>
                                            </div>
                                        </div>
                                    }

                                    @if (order.OrderItems.Count() > 3)
                                    {
                                        <div class="text-gray-500 text-sm">
                                            và @(order.OrderItems.Count() - 3) sản phẩm khác
                                        </div>
                                    }
                                </div>

                                <div class="flex justify-end">
                                    <a asp-controller="Orders" asp-action="Details" asp-route-id="@order.Id"
                                        class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                                        Xem chi tiết <i class="fas fa-arrow-right ml-1"></i>
                                    </a>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="text-center mt-6">
                        <a asp-controller="Orders" asp-action="Index"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                            Xem tất cả đơn hàng
                        </a>
                    </div>
                }
                else
                {
                    <div class="text-center py-12">
                        <i class="fas fa-shopping-bag text-gray-400 text-4xl mb-4"></i>
                        <h4 class="text-lg font-semibold text-gray-800 mb-2">Chưa có đơn hàng nào</h4>
                        <p class="text-gray-600 mb-6">Hãy bắt đầu mua sắm để có đơn hàng đầu tiên</p>
                        <a asp-controller="Books" asp-action="Index"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                            Khám phá sách hay
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Remove active state from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });

            // Show selected tab content
            document.getElementById(tabName + '-content').classList.remove('hidden');

            // Set selected tab as active
            const activeTab = document.getElementById(tabName + '-tab');
            activeTab.classList.remove('border-transparent', 'text-gray-500');
            activeTab.classList.add('border-blue-500', 'text-blue-600');
        }

        function uploadAvatar(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];

                // Check file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('File ảnh quá lớn. Vui lòng chọn file nhỏ hơn 5MB.', 'error');
                    return;
                }

                // Check file type
                if (!file.type.match('image.*')) {
                    showNotification('Vui lòng chọn file ảnh.', 'error');
                    return;
                }

                const formData = new FormData();
                formData.append('avatar', file);

                fetch('/Account/UploadAvatar', {
                    method: 'POST',
                    headers: {
                        'RequestVerificationToken': document.querySelector('[name="__RequestVerificationToken"]')?.value || ''
                    },
                    body: formData
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showNotification('Cập nhật ảnh đại diện thành công!', 'success');
                            // Update avatar display
                            const avatarImg = document.querySelector('.avatar-upload img');
                            if (avatarImg) {
                                avatarImg.src = data.avatarUrl;
                            } else {
                                // Create new img element if not exists
                                const avatarContainer = document.querySelector('.avatar-upload');
                                avatarContainer.innerHTML = `
                                            <img src="${data.avatarUrl}" alt="Avatar" class="w-full h-full rounded-full object-cover" />
                                            <div class="avatar-overlay">
                                                <i class="fas fa-camera text-white text-xl"></i>
                                            </div>
                                        `;
                            }
                        } else {
                            showNotification(data.message || 'Có lỗi xảy ra khi tải ảnh lên.', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showNotification('Có lỗi xảy ra khi tải ảnh lên.', 'error');
                    });
            }
        }

        function togglePassword(fieldName) {
            const field = document.querySelector(`[name="${fieldName}"]`);
            const eye = document.getElementById(fieldName + '-eye');

            if (field.type === 'password') {
                field.type = 'text';
                eye.classList.remove('fa-eye');
                eye.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                eye.classList.remove('fa-eye-slash');
                eye.classList.add('fa-eye');
            }
        }

        function enable2FA() {
            showNotification('Chức năng xác thực hai yếu tố đang được phát triển.', 'info');
            // Implementation for 2FA
        }

        // Handle avatar upload click
        document.querySelector('.avatar-upload').addEventListener('click', function () {
            document.getElementById('avatarUpload').click();
        });

        // Form submissions
        document.getElementById('profileForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(this);

            fetch(this.action, {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Cập nhật thông tin thành công!', 'success');
                    } else {
                        showNotification(data.message || 'Có lỗi xảy ra.', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Có lỗi xảy ra khi cập nhật thông tin.', 'error');
                });
        });

        document.getElementById('passwordForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(this);

            fetch(this.action, {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Đổi mật khẩu thành công!', 'success');
                        this.reset();
                    } else {
                        showNotification(data.message || 'Có lỗi xảy ra.', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Có lỗi xảy ra khi đổi mật khẩu.', 'error');
                });
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            showTab('profile');
        });
    </script>
}